<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kalender Sidang TA</title>
    <link rel="stylesheet" href="/stylesheets/output.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body class="bg-gray-100 font-sans">

    <!-- Header -->
    <header class="bg-green-600 text-white p-4 shadow-md">
      <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-3xl font-bold">SIMTASI</h1>
        <div>
          <button class="text-white bg-green-700 px-4 py-2 rounded-full hover:bg-green-800 focus:outline-none">
            <span
              style="background-image: url('../images/user_icon.png'); background-size: cover; background-position: center; width: 24px; height: 24px; display: inline-block;"></span>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto p-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <!-- Sidebar -->
        <%- include('../sidebar/sidebaradmin.ejs') %>

        <!-- Kalender Sidang TA -->
        <div class="col-span-3 bg-white p-6 rounded-lg shadow-lg">
          <h2 class="text-3xl font-semibold text-green-600 mb-6">Kalender Sidang TA</h2>

          <!-- Kalender -->
          <div class="flex justify-between mb-4">
            <button id="prevMonth" class="bg-blue-500 text-white px-4 py-2 rounded-md">Prev</button>
            <div id="monthYear" class="text-lg font-semibold"></div>
            <button id="nextMonth" class="bg-blue-500 text-white px-4 py-2 rounded-md">Next</button>
          </div>

          <div id="calendar" class="grid grid-cols-7 gap-2 mb-4"></div>

          <!-- Tanggal yang dipilih -->
          <div>
            <label for="selectedDate" class="block text-lg font-medium text-green-600 mb-2">Tanggal Sidang Terpilih:</label>
            <div id="selectedDate" class="text-lg font-semibold text-green-600"></div>
          </div>

          <!-- Tombol Apply -->
          <div class="flex justify-end space-x-4 mt-4">
            <button id="applyButton" class="bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700">Apply</button>
            <button id="clearButton" class="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">Clear</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-green-600 text-white text-center p-4 mt-6">
      <p>&copy; 2025 Sistem Informasi - Fakultas Teknologi Informasi</p>
    </footer>

    <!-- JavaScript untuk Kalender -->
    <script>
      let currentDate = new Date();
      const calendarContainer = document.getElementById("calendar");
      const monthYearDisplay = document.getElementById("monthYear");
      const prevMonthButton = document.getElementById("prevMonth");
      const nextMonthButton = document.getElementById("nextMonth");
      const selectedDateDisplay = document.getElementById("selectedDate");

      let selectedDayButton = null; // Variabel untuk menyimpan tombol tanggal yang dipilih

      // Menampilkan kalender sesuai bulan dan tahun saat ini
      function renderCalendar() {
        const month = currentDate.getMonth();
        const year = currentDate.getFullYear();
        const firstDay = new Date(year, month, 1).getDay(); // Hari pertama bulan
        const lastDate = new Date(year, month + 1, 0).getDate(); // Jumlah hari dalam bulan ini

        monthYearDisplay.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

        calendarContainer.innerHTML = '';

        // Menampilkan hari-hari dalam minggu
        const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        daysOfWeek.forEach(day => {
          const dayElement = document.createElement('div');
          dayElement.textContent = day;
          dayElement.classList.add('text-center', 'font-semibold', 'text-green-600');
          calendarContainer.appendChild(dayElement);
        });

        // Menampilkan tanggal dalam bulan ini
        for (let i = 0; i < firstDay; i++) {
          calendarContainer.appendChild(document.createElement('div')); // Menambahkan ruang kosong untuk hari sebelum tanggal 1
        }

        for (let day = 1; day <= lastDate; day++) {
          const dayButton = document.createElement('button');
          dayButton.textContent = day;
          dayButton.classList.add('w-full', 'px-4', 'py-2', 'border', 'border-gray-300', 'rounded-md', 'text-center', 'cursor-pointer');
          
          // Menandai tanggal yang sudah dipilih sebelumnya
          if (selectedDayButton && selectedDayButton.textContent == day) {
            dayButton.classList.add('bg-green-500', 'text-white');
          }

          dayButton.addEventListener('click', function() {
            console.log('Tanggal yang dipilih: ', day);
            // Jika tombol tanggal yang sama yang dipilih, jangan hapus
            if (selectedDayButton && selectedDayButton !== dayButton) {
              // Hapus class 'selected' dari tombol sebelumnya jika ada
              selectedDayButton.classList.remove('bg-green-500', 'text-white');
            }
            // Tambahkan class 'selected' pada tombol yang dipilih
            dayButton.classList.add('bg-green-500', 'text-white');
            selectedDayButton = dayButton;
            
            // Tampilkan tanggal yang dipilih
            const selectedDate = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            selectedDateDisplay.textContent = selectedDate; // Tampilkan tanggal yang dipilih
          });
          calendarContainer.appendChild(dayButton);
        }
      }

      // Navigasi bulan
      prevMonthButton.addEventListener("click", function() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      });

      nextMonthButton.addEventListener("click", function() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      });

      // Tombol Apply untuk menyimpan tanggal sidang
      document.getElementById("applyButton").addEventListener("click", function() {
        const selectedDate = selectedDateDisplay.textContent;
        if (selectedDate) {
          fetch('/kalender-sidang/save', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              tanggal: selectedDate,
              jenis_sidang: 'TA',
              email_user: 'admin@example.com'
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert("Tanggal Sidang berhasil disimpan!");
            } else {
              alert("Gagal menyimpan tanggal Sidang.");
            }
          })
          .catch(error => console.error('Error:', error));
        } else {
          alert("Pilih tanggal terlebih dahulu.");
        }
      });

      // Tombol Clear untuk menghapus tanggal sidang
      document.getElementById("clearButton").addEventListener("click", function() {
        selectedDateDisplay.textContent = ''; // Clear tanggal yang dipilih
        if (selectedDayButton) {
          selectedDayButton.classList.remove('bg-green-500', 'text-white');
          selectedDayButton = null;
        }
      });

      // Render kalender pertama kali
      renderCalendar();
    </script>

  </body>
</html>
