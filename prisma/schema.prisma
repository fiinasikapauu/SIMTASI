generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model topikta {
  id_topikta     Int              @id @default(autoincrement())
  topik          String           @db.VarChar(255)
  dosen          String           @db.VarChar(255)
  waktu          DateTime         @default(now()) @db.Timestamp(0)
  pendaftaran_ta pendaftaran_ta[]
}

model user {
  email_user       String             @id 
  nama             String
  nomorInduk       String             @unique(map: "User_nomorInduk_key")
  role             user_role
  password         String
  beban_bimbingan Int   @default(0) // Berikan nilai default, misalnya 0
  kalender_sidang  kalender_sidang[]
  konsultasi       konsultasi[]
  pendaftaran_ta   pendaftaran_ta[]
  proposal_ta      proposal_ta[]
  revisi_laporan   revisi_laporan[]
  draft_semhas     draft_semhas[]
  sidang_ta        sidang_ta[]
  draft_sidang     draft_sidang[]
  pendaftaran_semhas pendaftaran_semhas[]
  timeline_project timeline_project[]
  laporan_kemajuan laporan_kemajuan[]
  feedback         feedback[]         // Relasi balik ke model feedback
}

model kalender_sidang {
  id_kalender  Int      @id @default(autoincrement())
  email_user   String
  tanggal      DateTime
  jenis_sidang String
  user         user     @relation(fields: [email_user], references: [email_user], map: "Kalender_Sidang_email_user_fkey")

  @@index([email_user], map: "Kalender_Sidang_email_user_fkey")
}

model konsultasi {
  id_konsultasi      Int      @id @default(autoincrement())
  email_user         String
  tanggal_konsultasi DateTime
  topik_konsultasi   String
  dosen_pembimbing   String
  status             String
  user               user     @relation(fields: [email_user], references: [email_user], map: "Konsultasi_email_user_fkey")

  @@index([email_user], map: "Konsultasi_email_user_fkey")
}

model pendaftaran_ta {
  id_pendaftaran      Int      @id @default(autoincrement())
  email_user          String
  id_topikta          Int
  judul_ta            String
  tanggal_daftar      DateTime
  status_approval     String
  id_dosen_pembimbing String
  user                user     @relation(fields: [email_user], references: [email_user], map: "Pendaftaran_TA_email_user_fkey")
  topikta             topikta  @relation(fields: [id_topikta], references: [id_topikta], map: "Pendaftaran_TA_id_topikta_fkey")

  @@index([email_user], map: "Pendaftaran_TA_email_user_fkey")
  @@index([id_topikta], map: "Pendaftaran_TA_id_topikta_fkey")
}

model proposal_ta {
  id_proposal    Int      @id @default(autoincrement())
  email_user     String
  file_proposal  String
  tanggal_upload DateTime
  status_review  String
  feedback_dosen String
  user           user     @relation(fields: [email_user], references: [email_user], map: "Proposal_TA_email_user_fkey")

  @@index([email_user], map: "Proposal_TA_email_user_fkey")
}

model revisi_laporan {
  id_revisi      Int      @id @default(autoincrement())
  email_user     String
  file_laporan   String
  tanggal_upload DateTime
  feedback_dosen String
  status         String
  user           user     @relation(fields: [email_user], references: [email_user], map: "Revisi_Laporan_email_user_fkey")

  @@index([email_user], map: "Revisi_Laporan_email_user_fkey")
}

model draft_semhas {
  id_semhas       Int       @id @default(autoincrement())
  email_user      String
  file_draft      String
  tanggal_upload  DateTime?
  tanggapan_dosen String?
  status          String
  user            user      @relation(fields: [email_user], references: [email_user])

  @@index([email_user])
}

model sidang_ta {
  id_sidang         Int      @id @default(autoincrement())
  email_user        String
  tanggal_daftar    DateTime
  jadwal            DateTime
  nilai_akhir       Float
  user              user     @relation(fields: [email_user], references: [email_user], map: "Sidang_TA_email_user_fkey")

  @@index([email_user], map: "Sidang_TA_email_user_fkey")
}

model timeline_project {
  id_timeline     Int      @id @default(autoincrement())
  email_user      String
  tahapan         String
  tanggal_mulai   DateTime
  tanggal_selesai DateTime
  status          String
  user            user     @relation(fields: [email_user], references: [email_user], map: "Timeline_Project_email_user_fkey")

  @@index([email_user], map: "Timeline_Project_email_user_fkey")
}

model laporan_kemajuan {
  id_laporan        Int      @id @default(autoincrement())
  email_user        String
  file_laporan      String
  tanggal_upload    DateTime
  status_review     String
  feedback_dosen    String
  user              user     @relation(fields: [email_user], references: [email_user], map: "Laporan_Kemajuan_email_user_fkey")

  @@index([email_user], map: "Laporan_Kemajuan_email_user_fkey")
}

model feedback {
  id_feedback   Int      @id @default(autoincrement())
  email_user    String
  tanggal       DateTime
  feedback_text String
  user          user     @relation(fields: [email_user], references: [email_user], map: "Feedback_email_user_fkey")

  @@index([email_user], map: "Feedback_email_user_fkey")
}

model draft_sidang {
  id_draftsidang    Int       @id @default(autoincrement())
  email_user        String
  file_draft_sidang String
  tgl_upload        DateTime?
  balasan_dosen     String?
  status_draft      String
  user              user      @relation(fields: [email_user], references: [email_user])

  @@index([email_user])
}

model pendaftaran_semhas {
  id                Int      @id @default(autoincrement())
  email_user        String
  tanggal_seminar   DateTime
  status            String
  waktu_pendaftaran DateTime @default(now())
  user              user     @relation(fields: [email_user], references: [email_user])

  @@index([email_user])
}

enum user_role {
  ADMIN
  MAHASISWA
  DOSEN
}
